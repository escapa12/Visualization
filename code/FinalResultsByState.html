<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <title>US</title>
  <style>
  .boundary {
    fill: #ddd;
    stroke: #888;
    stroke-linejoin: round;
  }
  svg {
    border-style: solid;
    border-width: 1px;
    border-color: #ccc;
  }
  </style>
</head>
<body>
  <h1>US elections</h1>
  <div id="map"></div>
  <div id="infobox"></div>
  <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
  <script src="http://d3js.org/d3.v4.min.js"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>
  <script src="http://d3js.org/queue.v1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.5/d3-legend.js"></script>
  <script>
 
	  var height = 500,
          width = 860,
          projection = d3.geo.albersUsa()
				   .translate([500, height/2])    // translate to center of screen
				   .scale([900]);          // scale things down so see entire US

      // Special d3 helper that converts geo coordinates to paths
      // based on a projection
		// Define path generator
		var path = d3.geo.path()               // path generator that will convert GeoJSON to SVG paths
				  	 .projection(projection);  // tell path generator to use albersUsa projection
   	 

      var svg = d3.select("#map")
          .append("svg")
          .attr("width", width)
          .attr("height", height);
	  
	  /* The scale */	  
	  var ordinal = d3.scaleOrdinal() 
			.domain(["Bernie_Sanders","Hillary_Clinton","Donald_Trump","John_Kasich","Marco_Rubio","Ted_Cruz","Ben_Carson"])
			.range(["#3182bd","#08519c","#a50f15","#fee5d9","#fcae91","#fb6a4a","#de2d26"]);
	
	  /* The legend */
	  svg.append("g")
		.attr("class", "legendOrdinal")
		.attr("transform", "translate(20,20)");

	  var legendOrdinal = d3.legendColor()
		  .shapePadding(10)
		  .cellFilter(function(d){ return d.label !== "e" })
		  .scale(ordinal);
		
	  svg.select(".legendOrdinal")
	    .call(legendOrdinal);
	  /* end of legend */	
	  var map = svg.append('g').attr('class', 'boundary');

	  d3.csv("data/state_candidate2.csv", function(data) {

		d3.json("data/us-states.json", function(json) {
			for (var i = 0; i < data.length; i++) {
				// Grab State Name
				var dataState = data[i].state
				// Grab data value
				winnerName = "";

				if (+data[i].Bernie_Sanders > +data[i].Hillary_Clinton && +data[i].Bernie_Sanders > +data[i].Donald_Trump&& +data[i].Bernie_Sanders > +data[i].John_Kasich && +data[i].Bernie_Sanders > +data[i].Marco_Rubio && +data[i].Bernie_Sanders > +data[i].Ted_Cruz && +data[i].Bernie_Sanders > +data[i].Ben_Carson) {
					winnerName = "Bernie_Sanders";
				}

				else if (+data[i].Hillary_Clinton > +data[i].Bernie_Sanders && +data[i].Hillary_Clinton > +data[i].Donald_Trump && +data[i].Hillary_Clinton > +data[i].John_Kasich && +data[i].Hillary_Clinton > +data[i].Marco_Rubio && +data[i].Hillary_Clinton > +data[i].Ted_Cruz && +data[i].Hillary_Clinton > +data[i].Ben_Carson) {
					winnerName = "Hillary_Clinton";
				}
				else if (+data[i].Donald_Trump > +data[i].Bernie_Sanders && +data[i].Donald_Trump > +data[i].Hillary_Clinton && +data[i].Donald_Trump > +data[i].John_Kasich && +data[i].Donald_Trump > +data[i].Marco_Rubio && +data[i].Donald_Trump > +data[i].Ted_Cruz && +data[i].Donald_Trump > +data[i].Ben_Carson) {
					winnerName = "Donald_Trump";
				}
				else if (+data[i].John_Kasich > +data[i].Bernie_Sanders && +data[i].John_Kasich > +data[i].Hillary_Clinton && +data[i].John_Kasich > +data[i].Donald_Trump && +data[i].John_Kasich > +data[i].Marco_Rubio && +data[i].John_Kasich > +data[i].Ted_Cruz && +data[i].John_Kasich > +data[i].Ben_Carson) {
					winnerName = "John_Kasich";
				}
				else if (+data[i].Marco_Rubio > +data[i].Bernie_Sanders && +data[i].Marco_Rubio > +data[i].Hillary_Clinton && +data[i].Marco_Rubio > +data[i].Donald_Trump && +data[i].Marco_Rubio > +data[i].John_Kasich && +data[i].Marco_Rubio > +data[i].Ted_Cruz  && +data[i].Marco_Rubio > +data[i].Ben_Carson) {
					winnerName = "Marco_Rubio";
				}

				else if (+data[i].Ted_Cruz > +data[i].Bernie_Sanders && +data[i].Ted_Cruz > +data[i].Hillary_Clinton && +data[i].Ted_Cruz > +data[i].Donald_Trump && +data[i].Ted_Cruz > +data[i].John_Kasich && +data[i].Ted_Cruz > +data[i].Marco_Rubio  && +data[i].Ted_Cruz > +data[i].Ben_Carson) {
					winnerName = "Ted_Cruz";
				}

				else if (+data[i].Ben_Carson > +data[i].Bernie_Sanders && +data[i].Ben_Carson > +data[i].Hillary_Clinton && +data[i].Ben_Carson > +data[i].Donald_Trump && +data[i].Ben_Carson > +data[i].John_Kasich && +data[i].Ben_Carson > +data[i].Marco_Rubio  && +data[i].Ben_Carson > +data[i].Ted_Cruz) {
					winnerName = "Ben_Carson";
				}
				// Find the corresponding state inside the GeoJSON
				for (var j = 0; j < json.features.length; j++)  {
					var jsonState = json.features[j].properties.name;

					if (dataState == jsonState) {
						// Copy the data value into the JSON
						json.features[j].properties.winner = winnerName;
						// Stop looking through the JSON
						break;
						}
					}
			}

			// Bind the data to the SVG and create one path per GeoJSON feature
			map.selectAll("path")
				.data(json.features)
				.enter()
				.append("path")
				.attr("d", path)
				.attr('id',function(d){return d.id})
				.style("stroke", "#fff")
				.style("stroke-width", "1")
				.attr("fill", function(d) {
					return ordinal(d.properties.winner);			
				});

		});

		
	});

  </script>
</body>
</html>
